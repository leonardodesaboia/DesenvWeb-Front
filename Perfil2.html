
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil do Usuário</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="Perfil2.css">
</head>
<body>
    <nav class="navbar">
        <span class="navbar-brand">Bem-vindo ao seu Perfil</span>
        <button id="logout-btn" class="btn btn-warning">Sair</button>
        <button id="voltar-btn" class="btn btn-voltar" style="margin-right: 94%; background-color:lightblue;">Voltar</button>
    </nav>

    <div class="container">
        <!-- Cartão de perfil do usuário -->
        <div class="profile-card">
            <img id="profile-picture" src="https://via.placeholder.com/150" alt="Foto do usuário" class="rounded-circle">
            <h2 id="user-name">Nome Completo</h2>
            <p><strong>Email:</strong> <span id="user-email">usuario@email.com</span></p>
            <p><strong>CPF:</strong> <span id="user-cpf">000.000.000-00</span></p>
        
            <!-- Botão para atualizar imagem de perfil -->
            <input type="file" id="upload-profile-picture" accept="image/*" style="display: none;">
            <button id="change-profile-picture-btn" class="btn btn-light mt-3">Alterar Foto de Perfil</button>
        </div>
        

        <!-- Seção de reservas -->
        <div class="booking-section">
            <div id="reservas-container"></div>

        
              
              
        </div>
    </div>

    <script>
        // Função para manipular o botão CANCELAR com confirmação
        document.querySelectorAll('.btn.cancel').forEach(button => {
            button.addEventListener('click', (event) => {
                const row = event.target.closest('tr');
                const passeio = row.querySelector('td:nth-child(2)').textContent;
                const confirmar = confirm(`Tem certeza que deseja cancelar o passeio "${passeio}"?`);
                
                if (confirmar) {
                    row.remove();
                    alert(`O passeio "${passeio}" foi cancelado com sucesso!`);
                }
            });
        });

        // Função para o botão SAIR
  
    </script>
        
    <script type="module">
        import { authService } from './js/api.js'; 
        document.addEventListener('DOMContentLoaded', () => {
            const logoutButton = document.getElementById('logout-btn');
            if (logoutButton) {
                logoutButton.addEventListener('click', (event) => {
                    event.preventDefault();
                    authService.logout(); 
                });
            }
        });
        document.getElementById('logout-btn').addEventListener('click', () => {
            const confirmLogout = confirm('Tem certeza que deseja sair?');
            if (confirmLogout) {
                window.location.href = "index.html";
            }
        });

        document.getElementById('voltar-btn').addEventListener('click', () => {
                window.location.href = "index.html";
        });
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Carregar dados armazenados no localStorage
            const storedPicture = localStorage.getItem('profilePicture');
            const userName = localStorage.getItem('name');
            const userEmail = localStorage.getItem('email');
            const userCpf = localStorage.getItem('cpf');
        
            // Atualizar os campos da página
            const profilePicture = document.getElementById('profile-picture');
            if (storedPicture) {
                profilePicture.src = storedPicture; // Atualiza com a imagem do localStorage
            }
            if (userName) document.getElementById('user-name').textContent = userName;
            if (userEmail) document.getElementById('user-email').textContent = userEmail;
            if (userCpf) document.getElementById('user-cpf').textContent = userCpf;
        
            // Gerenciar o botão de upload
            const uploadInput = document.getElementById('upload-profile-picture');
            const changeButton = document.getElementById('change-profile-picture-btn');
        
            changeButton.addEventListener('click', () => {
                uploadInput.click(); // Abre o seletor de arquivos
            });
        
            uploadInput.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
        
                    reader.onload = (e) => {
                        const imageData = e.target.result;
                        // Atualiza a imagem no HTML
                        profilePicture.src = imageData;
                        // Armazena a imagem no localStorage
                        localStorage.setItem('profilePicture', imageData);
                    };
        
                    reader.readAsDataURL(file); // Lê o arquivo como Base64
                } else {
                    alert('Nenhuma imagem selecionada!');
                }
            });

            if (userCpf) {
            const formattedCpf = userCpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
            document.getElementById('user-cpf').textContent = formattedCpf;
}
        });
    </script>

    <script type="module">
        import { reservaService } from './js/api.js';
    
        document.addEventListener('DOMContentLoaded', async () => {
            const reservasContainer = document.getElementById('reservas-container');
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    reservasContainer.innerHTML = '<p>Você precisa estar logado para ver suas reservas.</p>';
                    return;
                }
                const tokenPayload = JSON.parse(atob(token.split('.')[1]));
                const clienteId = tokenPayload.id;
    
                const reservas = await reservaService.listarReservasPorCliente(clienteId);
    
                if (!reservas || reservas.length === 0) {
                    reservasContainer.innerHTML = '<p>Nenhuma reserva encontrada.</p>';
                    return;
                }
    
                reservasContainer.innerHTML = ''; // Limpa o contêiner
                reservas.forEach((reserva) => {
                    const reservaElement = document.createElement('div');
                    reservaElement.classList.add('reserva-item');
                    reservaElement.innerHTML = `
                        <p><strong>Passeio:</strong> ${reserva.passeio.nome}</p>
                        <p><strong>Data:</strong> ${reserva.data}</p>
                        <p><strong>Valor Total:</strong> R$ ${reserva.valorTotal}</p>
                        <p><strong>Status:</strong> ${reserva.status}</p>
                        <hr>
                    `;
                    reservasContainer.appendChild(reservaElement);
                });
            } catch (error) {
                console.error('Erro ao carregar reservas:', error);
                reservasContainer.innerHTML = '<p>Erro ao carregar reservas. Tente novamente mais tarde.</p>';
            }
        });
    </script>



    
</body>
</html>
